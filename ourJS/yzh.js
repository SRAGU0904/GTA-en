var yzhData = [{"": "0", "Unnamed: 0": "0", "iyear": "1970", "eventNum": "651", "killNum": "174", "woundNum": "212", "injureNum": "386"}, {"": "1", "Unnamed: 0": "1", "iyear": "1971", "eventNum": "471", "killNum": "173", "woundNum": "82", "injureNum": "255"}, {"": "2", "Unnamed: 0": "2", "iyear": "1972", "eventNum": "567", "killNum": "485", "woundNum": "409", "injureNum": "894"}, {"": "3", "Unnamed: 0": "3", "iyear": "1973", "eventNum": "473", "killNum": "370", "woundNum": "495", "injureNum": "865"}, {"": "4", "Unnamed: 0": "4", "iyear": "1974", "eventNum": "581", "killNum": "539", "woundNum": "865", "injureNum": "1404"}, {"": "5", "Unnamed: 0": "5", "iyear": "1975", "eventNum": "740", "killNum": "617", "woundNum": "617", "injureNum": "1234"}, {"": "6", "Unnamed: 0": "6", "iyear": "1976", "eventNum": "923", "killNum": "674", "woundNum": "756", "injureNum": "1430"}, {"": "7", "Unnamed: 0": "7", "iyear": "1977", "eventNum": "1319", "killNum": "457", "woundNum": "521", "injureNum": "978"}, {"": "8", "Unnamed: 0": "8", "iyear": "1978", "eventNum": "1526", "killNum": "1459", "woundNum": "1600", "injureNum": "3059"}, {"": "9", "Unnamed: 0": "9", "iyear": "1979", "eventNum": "2662", "killNum": "2100", "woundNum": "2506", "injureNum": "4606"}, {"": "10", "Unnamed: 0": "10", "iyear": "1980", "eventNum": "2661", "killNum": "4391", "woundNum": "3637", "injureNum": "8028"}, {"": "11", "Unnamed: 0": "11", "iyear": "1981", "eventNum": "2586", "killNum": "4851", "woundNum": "3337", "injureNum": "8188"}, {"": "12", "Unnamed: 0": "12", "iyear": "1982", "eventNum": "2543", "killNum": "5135", "woundNum": "3342", "injureNum": "8477"}, {"": "13", "Unnamed: 0": "13", "iyear": "1983", "eventNum": "2870", "killNum": "9444", "woundNum": "4047", "injureNum": "13491"}, {"": "14", "Unnamed: 0": "14", "iyear": "1984", "eventNum": "3495", "killNum": "10450", "woundNum": "5291", "injureNum": "15741"}, {"": "15", "Unnamed: 0": "15", "iyear": "1985", "eventNum": "2914", "killNum": "7094", "woundNum": "5112", "injureNum": "12206"}, {"": "16", "Unnamed: 0": "16", "iyear": "1986", "eventNum": "2860", "killNum": "4976", "woundNum": "5814", "injureNum": "10790"}, {"": "17", "Unnamed: 0": "17", "iyear": "1987", "eventNum": "3183", "killNum": "6482", "woundNum": "5775", "injureNum": "12257"}, {"": "18", "Unnamed: 0": "18", "iyear": "1988", "eventNum": "3720", "killNum": "7206", "woundNum": "6960", "injureNum": "14166"}, {"": "19", "Unnamed: 0": "19", "iyear": "1989", "eventNum": "4324", "killNum": "8152", "woundNum": "5539", "injureNum": "13691"}, {"": "20", "Unnamed: 0": "20", "iyear": "1990", "eventNum": "3886", "killNum": "7036", "woundNum": "6053", "injureNum": "13089"}, {"": "21", "Unnamed: 0": "21", "iyear": "1991", "eventNum": "4685", "killNum": "8454", "woundNum": "7620", "injureNum": "16074"}, {"": "22", "Unnamed: 0": "22", "iyear": "1992", "eventNum": "5071", "killNum": "9745", "woundNum": "10006", "injureNum": "19751"}, {"": "23", "Unnamed: 0": "23", "iyear": "1994", "eventNum": "3456", "killNum": "7690", "woundNum": "7569", "injureNum": "15259"}, {"": "24", "Unnamed: 0": "24", "iyear": "1995", "eventNum": "3081", "killNum": "6103", "woundNum": "14295", "injureNum": "20398"}, {"": "25", "Unnamed: 0": "25", "iyear": "1996", "eventNum": "3058", "killNum": "6966", "woundNum": "10760", "injureNum": "17726"}, {"": "26", "Unnamed: 0": "26", "iyear": "1997", "eventNum": "3198", "killNum": "10906", "woundNum": "8968", "injureNum": "19874"}, {"": "27", "Unnamed: 0": "27", "iyear": "1998", "eventNum": "934", "killNum": "4688", "woundNum": "8183", "injureNum": "12871"}, {"": "28", "Unnamed: 0": "28", "iyear": "1999", "eventNum": "1396", "killNum": "3394", "woundNum": "5405", "injureNum": "8799"}, {"": "29", "Unnamed: 0": "29", "iyear": "2000", "eventNum": "1823", "killNum": "4394", "woundNum": "5797", "injureNum": "10191"}, {"": "30", "Unnamed: 0": "30", "iyear": "2001", "eventNum": "1912", "killNum": "7729", "woundNum": "28187", "injureNum": "35916"}, {"": "31", "Unnamed: 0": "31", "iyear": "2002", "eventNum": "1330", "killNum": "4797", "woundNum": "7081", "injureNum": "11878"}, {"": "32", "Unnamed: 0": "32", "iyear": "2003", "eventNum": "1280", "killNum": "3317", "woundNum": "7384", "injureNum": "10701"}, {"": "33", "Unnamed: 0": "33", "iyear": "2004", "eventNum": "1164", "killNum": "5716", "woundNum": "11976", "injureNum": "17692"}, {"": "34", "Unnamed: 0": "34", "iyear": "2005", "eventNum": "2017", "killNum": "6343", "woundNum": "12961", "injureNum": "19304"}, {"": "35", "Unnamed: 0": "35", "iyear": "2006", "eventNum": "2757", "killNum": "9316", "woundNum": "15470", "injureNum": "24786"}, {"": "36", "Unnamed: 0": "36", "iyear": "2007", "eventNum": "3250", "killNum": "12825", "woundNum": "22531", "injureNum": "35356"}, {"": "37", "Unnamed: 0": "37", "iyear": "2008", "eventNum": "4801", "killNum": "9244", "woundNum": "19168", "injureNum": "28412"}, {"": "38", "Unnamed: 0": "38", "iyear": "2009", "eventNum": "4723", "killNum": "9277", "woundNum": "19147", "injureNum": "28424"}, {"": "39", "Unnamed: 0": "39", "iyear": "2010", "eventNum": "4827", "killNum": "7829", "woundNum": "15953", "injureNum": "23782"}, {"": "40", "Unnamed: 0": "40", "iyear": "2011", "eventNum": "5075", "killNum": "8246", "woundNum": "14662", "injureNum": "22908"}, {"": "41", "Unnamed: 0": "41", "iyear": "2012", "eventNum": "8525", "killNum": "15498", "woundNum": "25451", "injureNum": "40949"}, {"": "42", "Unnamed: 0": "42", "iyear": "2013", "eventNum": "12047", "killNum": "22279", "woundNum": "37694", "injureNum": "59973"}, {"": "43", "Unnamed: 0": "43", "iyear": "2014", "eventNum": "16960", "killNum": "44648", "woundNum": "41143", "injureNum": "85791"}, {"": "44", "Unnamed: 0": "44", "iyear": "2015", "eventNum": "15138", "killNum": "38993", "woundNum": "44204", "injureNum": "83197"}, {"": "45", "Unnamed: 0": "45", "iyear": "2016", "eventNum": "14051", "killNum": "35239", "woundNum": "40576", "injureNum": "75815"}, {"": "46", "Unnamed: 0": "46", "iyear": "2017", "eventNum": "11364", "killNum": "26897", "woundNum": "25594", "injureNum": "52491"}, {"": "47", "Unnamed: 0": "47", "iyear": "2018", "eventNum": "9853", "killNum": "23291", "woundNum": "20609", "injureNum": "43900"}, {"": "48", "Unnamed: 0": "48", "iyear": "2019", "eventNum": "8537", "killNum": "20412", "woundNum": "18776", "injureNum": "39188"}, {"": "49", "Unnamed: 0": "49", "iyear": "2020", "eventNum": "8438", "killNum": "22847", "woundNum": "15466", "injureNum": "38313"}, {"": "50", "Unnamed: 0": "50", "iyear": "2021", "eventNum": "4960", "killNum": "11545", "woundNum": "8333", "injureNum": "19878"}];

// Set the dimensions and margins of the chart
var yzh_margin = { top: 50, right: 60, bottom: 60, left: 20 },
    yzh_width = 1000 - yzh_margin.left - yzh_margin.right,
    yzh_height = 700 - yzh_margin.top - yzh_margin.bottom;

// Append the SVG to the chart div
var yzh_svg = d3.select("#yzh-chart #chart")
    .append("svg")
    .attr("width", yzh_width + yzh_margin.left + yzh_margin.right)
    .attr("height", yzh_height + yzh_margin.top + yzh_margin.bottom)
    .append("g")
    .attr("transform", "translate(" + yzh_margin.left + "," + yzh_margin.top + ")");

// Set the X and Y scales
var yzh_x = d3.scaleBand()
    .range([0, yzh_width])
    .padding(0);
var yzh_y = d3.scaleLinear()
    .range([0,yzh_height]);

// Set the domains of the scales
yzh_x.domain(yzhData.map(function(d) { return d.iyear; }));
yzh_y.domain([0,90000]);
// y.domain([0,d3.max(data, function(d) { return d.eventNum; })]);
var yzh_xAxis=d3.axisTop(yzh_x)
var yzh_xAxis_new=d3.axisTop(
    d3.scaleLinear()
    .range([0, yzh_width])
    .domain([1970,2021]))
    .ticks(5).tickValues([1970,1980,1990,2000,2010])
    .tickFormat(function(d) {
        if(d===2010) return d+"s & 2021"
        return d+'s';
    })

// Append the X axis to the SVG
yzh_svg.append("g")
    .call(yzh_xAxis_new)
    .selectAll("text")
    .style("text-anchor", "start")
    .attr('transform',"translate(75,0)");

// Append the Y axis to the SVG
yzh_svg.append("g")
    .attr("transform", "translate(920," + 0 + ")")
    .call(d3.axisRight(yzh_y)
    .tickFormat(function(d) { return d; })
    )
    .selectAll("text")


// Append the bars to the SVG
yzh_svg.selectAll(".bar3")
    .data(yzhData)
    .enter()
    .append("rect")
    .attr("class", "bar3")
    .attr("x", function(d) { return yzh_x(d.iyear); })
    .attr("width", (yzh_width)/yzhData.length)
    .attr("fill", "#7f0000")

var yzh_bars = yzh_svg.selectAll(".bar1")
    .data(yzhData)
    .enter()
    .append("rect")
    .attr("class", "bar1")
    .attr("x", function(d) { return yzh_x(d.iyear); })
    .attr("width", yzh_width/yzhData.length)
    .attr("fill", "#b70411")
    .attr("rx", 8) // Add this line
    .attr("ry", 8) // Add this line
    .on("mouseover", function(d) {
        let present_data=d.srcElement.__data__
        d3.select(this).attr("fill", "red");
        yzh_svg.append("text")
            .attr("class", "tooltip")
            .attr("x", yzh_x(present_data.iyear) + yzh_x.bandwidth() / 2)
            .attr("y", yzh_y(present_data.injureNum) +20 )
            .attr("text-anchor", "middle")
            .text(present_data.injureNum)
            .style('fill', 'rgba(0,0,0,0.84)');
    })
    .on("mouseout", function() {
        d3.select(this).attr("fill", "#b70411");
        yzh_svg.select(".tooltip").remove();
    })


var yzh_bars2 = yzh_svg.selectAll(".bar2")
    .data(yzhData)
    .enter()
    .append("rect")
    .attr("class", "bar2")
    .attr("x", function(d) { return yzh_x(d.iyear); })
    .attr("width", (yzh_width)/yzhData.length)
    .attr("fill", "#7f0000")
    .attr("rx", 8) // Add this line
    .attr("ry", 8) // Add this line
    .on("mouseover", function(d) {
        let present_data=d.srcElement.__data__
        d3.select(this).attr("fill", "red");
        yzh_svg.append("text")
            .attr("class", "tooltip")
            .attr("x", yzh_x(present_data.iyear) + yzh_x.bandwidth() / 2)
            .attr("y", yzh_y(present_data.eventNum) +20 )
            .attr("text-anchor", "middle")
            .text(present_data.eventNum)
            .style('fill', '#cecece');
    })
    .on("mouseout", function() {
        d3.select(this).attr("fill", "#7f0000");
        yzh_svg.select(".tooltip").remove();
    })


/// add legend
yzh_svg.append("text").attr("x", 30).attr("y", 300).text("Who are the most vulnerable tragets for terrorist attacks").style("font-size", "24px").attr("alignment-baseline","middle").style("fill", "#000000")

yzh_svg.append("circle").attr("cx",90).attr("cy",400).attr("r", 64).style("fill", "#7f0000")
yzh_svg.append("text").attr("x", 72).attr("y", 402).text("8254").style("font-size", "15px").attr("alignment-baseline","middle").style("fill", "#FFFFFF")
yzh_svg.append("text").attr("x", 71).attr("y", 490).text("civilian").style("font-size", "15px").attr("alignment-baseline","middle").style("fill", "#000000")

yzh_svg.append("circle").attr("cx",219).attr("cy",400).attr("r", 45).style("fill", "#7f0000")
yzh_svg.append("text").attr("x", 203).attr("y", 402).text("4199").style("font-size", "15px").attr("alignment-baseline","middle").style("fill", "#FFFFFF")
yzh_svg.append("text").attr("x", 200).attr("y", 490).text("soldier").style("font-size", "15px").attr("alignment-baseline","middle").style("fill", "#000000")

yzh_svg.append("circle").attr("cx",328).attr("cy",400).attr("r", 44).style("fill", "#7f0000")
yzh_svg.append("text").attr("x", 310).attr("y", 402).text("4005").style("font-size", "15px").attr("alignment-baseline","middle").style("fill", "#FFFFFF")
yzh_svg.append("text").attr("x", 280).attr("y", 490).text("transportation").style("font-size", "15px").attr("alignment-baseline","middle").style("fill", "#000000")

yzh_svg.append("circle").attr("cx",435).attr("cy",400).attr("r", 43).style("fill", "#7f0000")
yzh_svg.append("text").attr("x", 418).attr("y", 402).text("3805").style("font-size", "15px").attr("alignment-baseline","middle").style("fill", "#FFFFFF")
yzh_svg.append("text").attr("x", 400).attr("y", 490).text("inspection").style("font-size", "15px").attr("alignment-baseline","middle").style("fill", "#000000")

yzh_svg.append("circle").attr("cx",540).attr("cy",400).attr("r", 42).style("fill", "#7f0000")
yzh_svg.append("text").attr("x", 523).attr("y", 402).text("3633").style("font-size", "15px").attr("alignment-baseline","middle").style("fill", "#FFFFFF")
yzh_svg.append("text").attr("x", 495).attr("y", 490).text("traffic warden").style("font-size", "15px").attr("alignment-baseline","middle").style("fill", "#000000")



yzh_svg.append("text").attr("x", 770).attr("y", 30).text("Number of incidents").style("font-size", "20px").attr("alignment-baseline","middle").style("fill", "#FFFFFF")
yzh_svg.append("text").attr("x", 770).attr("y", 170).text("Number of casualties").style("font-size", "20px").attr("alignment-baseline","middle").style("fill", "#FFFFFF")


function animateBars() {
    yzh_svg.selectAll(".bar1")
        .attr("height", 0)
        .transition()
        .duration(2800)
        .attr("height", function(d) { return yzh_y(d.injureNum); });

    yzh_svg.selectAll(".bar2")
        .attr("height", 0)
        .transition()
        .duration(1500)
        .attr("height", function(d) {

            return yzh_y(d.eventNum); });

    yzh_svg.selectAll(".bar3")
        .attr("height", 0)
        .transition()
        .duration(1500)
        .attr("height", function(d) { return yzh_y(d.eventNum)/2; });
}

// Call the animation function for the initial animation
setTimeout(()=>animateBars(),500)
// Add a click event listener to trigger the animation
d3.select("#chart").on("click", function() {
    animateBars();
});
